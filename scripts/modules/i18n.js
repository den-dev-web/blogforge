const I18N = {
  uk: {
    categories: {
      technology: "Технології",
      business: "Бізнес",
      design: "Дизайн",
      science: "Наука",
      lifestyle: "Lifestyle",
      all: "Всі",
    },
    ui: {
      menu: "Меню",
      openMenu: "Відкрити меню",
      closeMenu: "Закрити меню",
      searchAction: "Пошук...",
      languageLabel: "Мова",
      searchLabel: "Пошук",
      searchPlaceholder: "Пошук статей",
      searchScopeLabel: "Де шукати",
      searchScopePosts: "Пости",
      searchScopePeople: "Люди",
      searchScopeTags: "Теги",
      searchScopeComments: "Коментарі",
      searchFiltersLabel: "Пошук і фільтри",
      filtersCurrent: "Актуальне",
      filtersLatest: "Останнє",
      filtersBest: "Найкраще",
      filtersPeriodLabel: "Період",
      filtersWeek: "Тиждень",
      filtersMonth: "Місяць",
      filtersYear: "Рік",
      filtersAll: "Усі",
      clear: "Очистити",
      endList: "Кінець списку",
      empty: "Немає матеріалів за фільтром.",
      error: "Не вдалося завантажити матеріали.",
      retry: "Спробувати ще",
      subscribeSuccess: "Дякуємо! Ми на звʼязку.",
      commentSuccess: "Коментар отримано. Очікує модерації.",
      commentsIntro: "Обговорення статті від читачів BlogForge.",
      commentAuthNotice: "Коментувати можуть лише зареєстровані користувачі.",
    },
    hero: {
      tag: "Вибір редакції",
      title: "BlogForge медіа-платформа",
      subtitle:
        "Лонгріди, практичні гіди та нотатки для технологій, бізнесу й культури.",
    },
    sections: {
      categories: "Категорії",
      popular: "Популярне зараз",
      media: "Подкасти та відео",
      subscribe: "Підписатися на оновлення",
      related: "Схожі статті",
      comments: "Коментарі",
    },
    buttons: {
      startReading: "Почати читати",
      subscribe: "Підписатися",
      joinList: "Приєднатися",
      submit: "Надіслати",
      auth: "Увійдіть",
      toggleTheme: "Перемкнути тему",
    },
    forms: {
      emailLabel: "Email",
      emailHint: "Щотижневий дайджест без спаму.",
      nameLabel: "Ім'я",
      commentLabel: "Коментар",
    },
    footer: {
      catalog: "Каталог",
      subscribe: "Підписка",
      article: "Стаття",
      meta: "Незалежна редакційна студія. Всі права захищені.",
    },
    labels: {
      podcast: "Подкаст",
      video: "Відео",
    },
    cards: {
      popular1: {
        title: "Сигнали з передової",
        excerpt: "Короткий анонс для матеріалу з найближчим дедлайном.",
      },
      popular2: {
        title: "Ритуали сфокусованої роботи",
        excerpt: "Короткий анонс для матеріалу з найближчим дедлайном.",
      },
      popular3: {
        title: "Нотатки оператора зростання",
        excerpt: "Короткий анонс для матеріалу з найближчим дедлайном.",
      },
      media1: {
        title: "Щотижневий редакційний дайджест",
        excerpt: "Короткий анонс для медіа-епізоду.",
      },
      media2: {
        title: "Глибинні огляди до 10 хвилин",
        excerpt: "Короткий анонс для медіа-епізоду.",
      },
    },
    article: {
      title: "Проєктування стійких систем",
      date: "12 січня",
      readingTime: "8 хв читання",
      coverLabel: "Обкладинка статті",
      section1Title: "Редакційна теза",
      section1Text:
        "Будуйте системи, що тримають удар, масштабуються з наміром і залишають місце для людських рішень.",
      section2Title: "Про що команди забувають",
      section2Text:
        "Стійкість — це не лише аптайм. Це навчальні цикли та чіткі межі.",
      quote:
        "Команди, що фіксують рішення, живуть довше за ті, що фіксують лише задачі.",
      section3Title: "Сигнали, за якими варто стежити",
      list1: "Стрибки латентності під час пікової співпраці.",
      list2: "Непризначені сервіси без on-call чергування.",
      list3: "Відсутність дизайн-рев'ю перед продакшен-змінами.",
      caption: "Системи ростуть, коли команда бачить повну мапу.",
      related1Title: "Операторський довідник для масштабу",
      related1Excerpt: "Короткий анонс для матеріалу з найближчим дедлайном.",
      related2Title: "Редакційна майстерність для команд",
      related2Excerpt: "Короткий анонс для матеріалу з найближчим дедлайном.",
      related3Title: "Сигнали з передової",
      related3Excerpt: "Короткий анонс для матеріалу з найближчим дедлайном.",
      comment1Author: "Олена Баранова",
      comment1Meta: "2 дні тому · Київ",
      comment1Text:
        "Сподобалося, як розкрито тему про on-call. У нас це болюча точка.",
      comment2Author: "Тарас Коваль",
      comment2Meta: "Вчора · Харків",
      comment2Text: "Додайте, будь ласка, приклад метрик для продуктових команд.",
      comment3Author: "Ірина Марченко",
      comment3Meta: "5 днів тому · Львів",
      comment3Text:
        "Погоджуюсь щодо дизайн-рев'ю — без нього важко тримати якість.",
    },
  },
  en: {
    categories: {
      technology: "Technology",
      business: "Business",
      design: "Design",
      science: "Science",
      lifestyle: "Lifestyle",
      all: "All",
    },
    ui: {
      menu: "Menu",
      openMenu: "Open menu",
      closeMenu: "Close menu",
      searchAction: "Search...",
      languageLabel: "Language",
      searchLabel: "Search",
      searchPlaceholder: "Search articles",
      searchScopeLabel: "Search in",
      searchScopePosts: "Posts",
      searchScopePeople: "People",
      searchScopeTags: "Tags",
      searchScopeComments: "Comments",
      searchFiltersLabel: "Search & filters",
      filtersCurrent: "Trending",
      filtersLatest: "Latest",
      filtersBest: "Best",
      filtersPeriodLabel: "Period",
      filtersWeek: "Week",
      filtersMonth: "Month",
      filtersYear: "Year",
      filtersAll: "All",
      clear: "Clear",
      endList: "End of list",
      empty: "No articles match your filters yet.",
      error: "Unable to load articles.",
      retry: "Retry",
      subscribeSuccess: "Thanks! We'll be in touch.",
      commentSuccess: "Comment received. Moderation pending.",
      commentsIntro: "Reader discussion of this article.",
      commentAuthNotice: "Only registered users can comment.",
    },
    hero: {
      tag: "Editorial picks",
      title: "BlogForge media platform",
      subtitle:
        "Longform reads, practical playbooks, and creator notes across tech, business, and culture.",
    },
    sections: {
      categories: "Categories",
      popular: "Popular now",
      media: "Podcasts and video",
      subscribe: "Subscribe for updates",
      related: "Related stories",
      comments: "Comments",
    },
    buttons: {
      startReading: "Start reading",
      subscribe: "Subscribe",
      joinList: "Join the list",
      submit: "Submit",
      auth: "Sign in",
      toggleTheme: "Toggle theme",
    },
    forms: {
      emailLabel: "Email",
      emailHint: "Weekly digest, no spam.",
      nameLabel: "Name",
      commentLabel: "Comment",
    },
    footer: {
      catalog: "Catalog",
      subscribe: "Subscribe",
      article: "Article",
      meta: "Independent editorial studio. All rights reserved.",
    },
    labels: {
      podcast: "Podcast",
      video: "Video",
    },
    cards: {
      popular1: {
        title: "Signals from the frontier",
        excerpt: "Short preview text for the feature article goes here.",
      },
      popular2: {
        title: "Rituals for focused work",
        excerpt: "Short preview text for the feature article goes here.",
      },
      popular3: {
        title: "Operator notes on growth",
        excerpt: "Short preview text for the feature article goes here.",
      },
      media1: {
        title: "The weekly editorial desk",
        excerpt: "Short preview text for the feature media goes here.",
      },
      media2: {
        title: "Deep dives in under 10",
        excerpt: "Short preview text for the feature media goes here.",
      },
    },
    article: {
      title: "Designing resilient systems",
      date: "Jan 12",
      readingTime: "8 min read",
      coverLabel: "Article cover",
      section1Title: "The editorial thesis",
      section1Text:
        "Build systems that hold steady under pressure, scale with intent, and make room for human judgment.",
      section2Title: "What teams forget",
      section2Text:
        "Resilience is not just about uptime. It is about learning loops and clear boundaries.",
      quote:
        "Teams that document decisions outlast teams that only document tasks.",
      section3Title: "Signals to watch",
      list1: "Latency spikes during peak collaboration hours.",
      list2: "Unowned services with no on-call rotation.",
      list3: "Missing design reviews before production changes.",
      caption: "Systems grow when the team sees the whole map.",
      related1Title: "Operators handbook for scale",
      related1Excerpt: "Short preview text for the feature article goes here.",
      related2Title: "Editorial craft for modern teams",
      related2Excerpt: "Short preview text for the feature article goes here.",
      related3Title: "Signals from the frontier",
      related3Excerpt: "Short preview text for the feature article goes here.",
      comment1Author: "Olena Baranova",
      comment1Meta: "2 days ago · Kyiv",
      comment1Text:
        "Loved the way you framed on-call. It is a pain point for our team too.",
      comment2Author: "Taras Koval",
      comment2Meta: "Yesterday · Kharkiv",
      comment2Text: "Please add a metrics example for product teams.",
      comment3Author: "Iryna Marchenko",
      comment3Meta: "5 days ago · Lviv",
      comment3Text:
        "Agree on design reviews — it is hard to keep quality without them.",
    },
  },
  ru: {
    categories: {
      technology: "Технологии",
      business: "Бизнес",
      design: "Дизайн",
      science: "Наука",
      lifestyle: "Lifestyle",
      all: "Все",
    },
    ui: {
      menu: "Меню",
      openMenu: "Открыть меню",
      closeMenu: "Закрыть меню",
      searchAction: "Поиск...",
      languageLabel: "Язык",
      searchLabel: "Поиск",
      searchPlaceholder: "Поиск статей",
      searchScopeLabel: "Где искать",
      searchScopePosts: "Посты",
      searchScopePeople: "Люди",
      searchScopeTags: "Теги",
      searchScopeComments: "Комментарии",
      searchFiltersLabel: "Поиск и фильтры",
      filtersCurrent: "Актуальное",
      filtersLatest: "Последнее",
      filtersBest: "Лучшее",
      filtersPeriodLabel: "Период",
      filtersWeek: "Неделя",
      filtersMonth: "Месяц",
      filtersYear: "Год",
      filtersAll: "Все",
      clear: "Очистить",
      endList: "Конец списка",
      empty: "Нет материалов по фильтру.",
      error: "Не удалось загрузить материалы.",
      retry: "Повторить",
      subscribeSuccess: "Спасибо! Мы на связи.",
      commentSuccess: "Комментарий получен. Ожидает модерации.",
      commentsIntro: "Обсуждение статьи от читателей BlogForge.",
      commentAuthNotice: "Комментировать могут только зарегистрированные пользователи.",
    },
    hero: {
      tag: "Выбор редакции",
      title: "BlogForge медиа-платформа",
      subtitle:
        "Лонгриды, практические гиды и заметки о технологиях, бизнесе и культуре.",
    },
    sections: {
      categories: "Категории",
      popular: "Популярное сейчас",
      media: "Подкасты и видео",
      subscribe: "Подписаться на обновления",
      related: "Похожие статьи",
      comments: "Комментарии",
    },
    buttons: {
      startReading: "Начать читать",
      subscribe: "Подписаться",
      joinList: "Присоединиться",
      submit: "Отправить",
      auth: "Войти",
      toggleTheme: "Переключить тему",
    },
    forms: {
      emailLabel: "Email",
      emailHint: "Еженедельный дайджест без спама.",
      nameLabel: "Имя",
      commentLabel: "Комментарий",
    },
    footer: {
      catalog: "Каталог",
      subscribe: "Подписка",
      article: "Статья",
      meta: "Независимая редакционная студия. Все права защищены.",
    },
    labels: {
      podcast: "Подкаст",
      video: "Видео",
    },
    cards: {
      popular1: {
        title: "Сигналы с передовой",
        excerpt: "Короткий анонс для материала с ближайшим дедлайном.",
      },
      popular2: {
        title: "Ритуалы сфокусированной работы",
        excerpt: "Короткий анонс для материала с ближайшим дедлайном.",
      },
      popular3: {
        title: "Заметки оператора роста",
        excerpt: "Короткий анонс для материала с ближайшим дедлайном.",
      },
      media1: {
        title: "Еженедельный редакционный дайджест",
        excerpt: "Короткий анонс для медиа-эпизода.",
      },
      media2: {
        title: "Глубокие обзоры до 10 минут",
        excerpt: "Короткий анонс для медиа-эпизода.",
      },
    },
    article: {
      title: "Проектирование устойчивых систем",
      date: "12 янв",
      readingTime: "8 мин чтения",
      coverLabel: "Обложка статьи",
      section1Title: "Редакционная тезис",
      section1Text:
        "Стройте системы, которые держат удар, масштабируются осознанно и оставляют место для человеческих решений.",
      section2Title: "О чем команды забывают",
      section2Text:
        "Устойчивость — это не только аптайм. Это циклы обучения и четкие границы.",
      quote:
        "Команды, которые фиксируют решения, живут дольше тех, кто фиксирует только задачи.",
      section3Title: "Сигналы, за которыми стоит следить",
      list1: "Скачки задержки в часы пиковой совместной работы.",
      list2: "Сервисы без владельцев и on-call ротации.",
      list3: "Отсутствие дизайн-ревью перед продакшен-изменениями.",
      caption: "Системы растут, когда команда видит полную карту.",
      related1Title: "Операторский справочник для масштаба",
      related1Excerpt: "Короткий анонс для материала с ближайшим дедлайном.",
      related2Title: "Редакционное мастерство для команд",
      related2Excerpt: "Короткий анонс для материала с ближайшим дедлайном.",
      related3Title: "Сигналы с передовой",
      related3Excerpt: "Короткий анонс для материала с ближайшим дедлайном.",
      comment1Author: "Елена Баранова",
      comment1Meta: "2 дня назад · Киев",
      comment1Text:
        "Понравилось, как раскрыта тема on-call. Для нас это болезненная точка.",
      comment2Author: "Тарас Коваль",
      comment2Meta: "Вчера · Харьков",
      comment2Text: "Добавьте, пожалуйста, пример метрик для продуктовых команд.",
      comment3Author: "Ирина Марченко",
      comment3Meta: "5 дней назад · Львов",
      comment3Text:
        "Согласна насчет дизайн-ревью — без него сложно удерживать качество.",
    },
  },
};

const getLang = () => document.documentElement.dataset.lang || "uk";

const applyTranslations = () => {
  const lang = getLang();
  const dict = I18N[lang] || I18N.uk;
  const resolveKey = (path) =>
    path.split(".").reduce((acc, key) => (acc ? acc[key] : undefined), dict);

  document.querySelectorAll("[data-i18n]").forEach((node) => {
    const key = node.dataset.i18n;
    const value = resolveKey(key);
    if (value) {
      node.textContent = value;
    }
  });

  document.querySelectorAll("[data-i18n-placeholder]").forEach((node) => {
    const key = node.dataset.i18nPlaceholder;
    const value = resolveKey(key);
    if (value) {
      node.setAttribute("placeholder", value);
    }
  });

  document.querySelectorAll("[data-i18n-attr]").forEach((node) => {
    const mappings = node.dataset.i18nAttr.split(";");
    mappings.forEach((entry) => {
      const [attr, key] = entry.split(":");
      if (!attr || !key) return;
      const value = resolveKey(key);
      if (value) {
        node.setAttribute(attr, value);
      }
    });
  });
};

const getUiLabel = (key, lang = getLang()) => {
  const dict = I18N[lang] || I18N.uk;
  return dict.ui[key] || key;
};

const initLanguage = (onChange) => {
  const switches = document.querySelectorAll("[data-lang-switch]");
  if (!switches.length) return;

  const switchers = document.querySelectorAll("[data-lang-switcher]");
  const getToggle = (switcher) => switcher.querySelector("[data-lang-toggle]");

  const setOpenState = (switcher, isOpen) => {
    switcher.dataset.open = String(isOpen);
    const toggle = getToggle(switcher);
    toggle?.setAttribute("aria-expanded", String(isOpen));
  };

  const updateSwitchers = (lang) => {
    switchers.forEach((switcher) => {
      const current = switcher.querySelector("[data-lang-current]");
      const active = switcher.querySelector(`[data-lang-switch="${lang}"]`);
      if (current && active) {
        current.textContent = active.textContent;
      }
      switcher.querySelectorAll("[data-lang-switch]").forEach((btn) => {
        const isActive = btn.dataset.langSwitch === lang;
        btn.setAttribute("aria-selected", String(isActive));
      });
    });
  };

  const setLanguage = (lang) => {
    document.documentElement.dataset.lang = lang;
    document.documentElement.setAttribute("lang", lang);
    updateSwitchers(lang);
    applyTranslations();
    if (typeof onChange === "function") {
      onChange(lang);
    }
  };

  switchers.forEach((switcher) => {
    const toggle = getToggle(switcher);
    if (!toggle) return;
    toggle.addEventListener("click", (event) => {
      event.stopPropagation();
      const isOpen = switcher.dataset.open === "true";
      switchers.forEach((other) => setOpenState(other, false));
      setOpenState(switcher, !isOpen);
    });
  });

  switches.forEach((btn) => {
    btn.addEventListener("click", () => {
      setLanguage(btn.dataset.langSwitch);
      switchers.forEach((switcher) => setOpenState(switcher, false));
    });
  });

  document.addEventListener("click", (event) => {
    if (event.target.closest("[data-lang-switcher]")) return;
    switchers.forEach((switcher) => setOpenState(switcher, false));
  });

  document.addEventListener("keydown", (event) => {
    if (event.key !== "Escape") return;
    switchers.forEach((switcher) => setOpenState(switcher, false));
  });

  setLanguage(getLang());
};

export { initLanguage, I18N, getLang, applyTranslations, getUiLabel };
